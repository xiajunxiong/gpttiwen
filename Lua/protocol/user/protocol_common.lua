PROTC_LONGLONG = 8 ---LL长度

PROTC_ROLE_NAME_LEN = 64 ---角色/宠物名长度

PROTC_GUILD_NAME_LEN = 64 ---家族名长度

PROTC_GUILD_BANNER = 8 ---家族族徽长度

PROTC_PLAT_NAME_LEN = 64 ---

PROTC_LOGIN_STR_LEN = 32

PROTC_SESSION_KEY_LEN = 32

PROTC_HOST_NAME_LEN = 64 ---服务器地址长度（ip,域名）

PROTC_TEAM_NOTICE_LEN = 256 ---组队招募信息长度

PROTC_GROUP_NOTICE_LEN = 256 ---群聊公告信息长度

MAIL_SUBJECT = 128 ---邮件主题

MAIL_CONTENT_TXT = 1200 ---邮件内容

SHITU_SEEKING_NOTICE = 128 ---师徒宣言长度

CHAT_SIMPLE_RECORD = 32 ---快捷发言长度

SHARE_MSG = 64 ---私聊红包留言长度

PET_SKILL_MAX_COUNT = 10 ---宠物技能数

PET_GIFT_MAX_COUNT = 20 ---天赋数

PET_ATTR_LIST_COUNT = 50 ---宠物属性个数

MAX_PET_EQUIPMENT_SKILL_NUM = 2 ---宠物装备技能数量

MAX_PET_STRENGTHEN_LV_NORMAL = 10 -- 宠物普通强化等级上限

MAX_PET_STRENGTHEN_FlY_NOE = 12     -- 飞升一阶宠物强化等级上限

MAX_PET_STRENGTHEN_LEVEL = 15 --- 飞升二阶阶宠物强化等级上限

BATTLE_MAX_CH_NUM = 20 ---战斗中角色最大数

BATTLE_PET_NUM = 3 ---战斗可带宠物数

BATTLE_SKILL_NUM = 15 ---战斗中每个角色能带的最大技能数

EQUIP_ITEM_ATTR_NUM = 6 ---装备物品默认属性读取个数

MEDAL_ITEM_ATTR_NUM = 4 ---勋章物品默认属性读取个数

EQUIP_STONE_COUNT_MAX = 4 ---宝石镶嵌最大个数

EQUIP_STONE_EXTEND_MAX = 10 ---宝石镶嵌可扩展到的最大数量

EQUIP_SPIRIT_MAX = 5 -- 装备铸灵最大数量

EQUIP_SPIRIT_RESOLVE_MAX = 100 -- 一次性分解铸灵最大数量

ACCRSSORY_MAX = 5 -- 配饰最大数量

ACCRSSORY_ATTR_MAX = 7 -- 配饰词条最大数量

GUILD_BUILDING_MAX = 5 -- 家族内政建设建筑最大数量

SPECIAL_RECIPE_LIST_TOTAL_NUM_MAX = 80 ---所有可激活配方激活状态

ACT_LUCKY_COW_MAX_USER = 5 -- 福牛报喜中奖用户最大数量

INT_MAX = 2147483647 ---int最大值

EQUIP_LIST_MAX = 5 ---装备接收列表数

JEWELTY_LIST_MAX = 3 ---首饰接收列表数

JEWELTY_REFORGE_LIST_MAX = 3 ---重锻接收列表数

GUILD_EVENTHANDLER_COUNT = 20

GUILD_MAX_MEMBER_COUNT = 256

GUILD_BUILD_COUNT = 4

CREATE_GUILD_LEVEL_LIMTI = 12

MAX_ONCE_GUILD_COUNT = 100

GUILD_EVENTHANDLER_PARAM = 10000

GUILD_SAVE_INTERVAL = 60

GUILD_PET_TRAINING_PET_MAX_COUNT = 3

GUILD_PET_TRAINING_TYPE_COUNT = 4

GUILD_BUILD_COUNT = 4

GUILD_GUILD_DONATE_COUNT_MAX = 20

PROTOCAL_MAX_SYSTEM_MSG_LENGTH = 2048

MI_YI_MAX_LEVEL = 10

MI_YI_MAX_MONSTER_NUM = 10

MAX_FABAO_EQUIPMENT_BAR = 4

MAX_FABAO_COUNT = 43

SHOP_BUY_MAX_COUNT = 128 -- 商店最大限购物品数量

SHOP_TIME_LIMIT_BUY_MAX_COUNT = 12 -- 商店限时购买最大数量

CAMPAIGN_RINK_MAX_NUM = 8 -- 首席竞选最多人数

INTJEWELRY_SUCC_MAX_GROUP = 31 -- 灵饰品质组最大组数

ACT_SHOP_BUY_MAX_COUNT = 30 -- 商店最大限购物品数量

COLORFUL_ILLUSTRATE_IMAGE_NUM = 9 -- 七彩图鉴最大图片数量

COLORFUL_ILLUSTRATE_MAX_NUM = 7 -- 七彩图鉴最多图鉴数量

FACE_ADDITION_TYPE_MAX = 10 -- 颜值装备网络包最大个数

FACE_ADDITION_FLAG_MAX = 32 -- 颜值激活网络包最大个数 32 * 32

COLLECTION_INCLUDED_MAX = 63 -- 图鉴收录最大数量 63 * 32

MAX_ATLAS_CARD_NUM = 100 --珍品图鉴卡

TRADE_UNIQUE_KEY_MAX = 24   --交易行唯一标识最大长度

TRADE_BAG_MAX_NUM = 12 -- 交易行背包显示数量

RA_COLLECT_WORD_MAX_ENTRY_NUM = 20 -- 集字信息

RA_LUCKY_TURNTABLE_TASK_MAX_NUM = 20 -- 幸运转盘任务数量

RA_LUCKY_DISCOUNT_MAX_NUM = 24 -- 幸运折扣最大物品数量

ROLE_ATTRIBUTE_PLAN_MAX_NUM = 5 -- 加点接受最多

MAX_ATTR_PLAN_NUM = 3 -- 加点方案最多个数

ATTRIBUTE_PLAN_NAME_LENGTH = 64 -- 方案名字长度

ACHIEVEMENT_TYPE_NUM = 1024

PRESTIGE_VILLAGE_GOODS_MAX_NUM = 2000

XUN_BAO_DRAW_CUMULATIVE_TIMES_GROUP_MAX_NUM = 10 -- 寻宝抽奖励次数

SHXY_SUIPIAN_XINGJI = 5 -- 山海降妖碎片星级数

SHXY_SUIPIAN_LEIXING = 12 -- 山海降妖碎片类型数

RA_HERITAGE_TREASURE_TREASURE_MAX_PIECE = 13

RA_XIAN_SHI_BAO_HE_MAX_ITEM = 20 -- 限时宝盒
RA_XIAN_SHI_BAO_DAI_MAX_ITEM = 20 -- 限时宝袋
RA_SHAN_HAI_BAO_HE_MAX_ITEM = 20 -- 山海宝盒
RA_SHAN_HAI_BAO_DAI_MAX_ITEM = 20 -- 山海宝袋
RA_YUN_ZE_BAO_HE_MAX_ITEM = 20 -- 云泽宝盒
RA_YUN_ZE_BAO_DAI_MAX_ITEM = 20 -- 云泽宝袋

RA_FOUR_SEASON_CARD_MAX_ITEM = 20 -- 四季花牌
RA_FOUR_SEASON_BOX_MAX_ITEM = 20 -- 四季宝盒
RA_FOUR_SEASON_CHEST_MAX_ITEM = 20 -- 四季宝箱

RA_GOD_CLOTHES_MAX_BUY_ITEM = 20 -- 神赐华服购买道具
RA_GOD_CLOTHES_MAX_EXCHANGE_ITEM = 26 -- 神赐华服兑换道具

PLAT_SPID = 4 -- 子包渠道号

ROLE_PROFESSION_MAX_NUM = 8 -- 人物职业最多种类

DRAW_GROUP_MAX_ITEM_NUM = 5 -- 翻牌系统牌数量
SIDE_MAX_ROLE_NUM = 5 -- 队伍人数
DRAW_ITEM_PARAM_MAX = 1256 -- 翻牌物品净值最大值

COLOSSEUM_DEFENDER_BUFF_NUM = 3 -- 竞技场中buff数量

SEVEN_DAY_GOAL_MAX_NUM = 7 -- 新服试炼目标数量

MAX_XUN_BAO_BLESS_PET_NUM = 5
GUILD_HONOR_BATTLE_MAX_ROUND = 4 -- 回合
GUILD_HONOR_BATTLE_MAX_ZONE = 3 -- 区域
GUILD_HONOR_BATTLE_FIGHTER_MAX_NUM = 16 -- 最大人数

PET_MONOPOLY_GRID_NUM = 36 -- 灵兽岛格子数量上限

PET_MONOPOLY_TURNTABLE_SECTOR_NUM = 8 -- 灵兽岛转盘格子数量

CLOUD_ARENA_USER_FIGHT_RECORD_NUM = 20 -- 云端竞技战报数量上限

CLOUD_ARENA_ACHIEVEMENT_MAX = 9 -- 云端竞技成就上限

FA_BAO_DRAW_MATERIAL_MAX_NUM = 5 -- 材料个数

FA_BAO_DRAW_ITEM_MAX_NUM = 4 -- 抽奖鼎个数

FA_BAO_DRAW_MAX_RATE = 100 -- 概率和

MAX_GUILD_INBORN_SKILL_CUR_NUM = 36 -- 灵脉
MAX_GUILD_INBORN_SKILL_TYPE_IN_HAS_SKILL_CUR_NUM = 6

HEART_SKILL_MAX_LEVEL = 5

HONG_BAO_GREETING = 128
RA_WAN_LING_GONG_YING_TASK_MAX = 10 -- 万灵共盈任务最大数量

SURFACE_MAX_NUM = 600   --时装，武器，坐骑最大总数量

SWORN_PREFIX_NAME_LEN = 8 --结义组名字前缀长度
SWORN_SUFFIX_NAME_LEN = 4 --结义组名字后缀长度
SWORN_ROLE_NAME_LEN = 8   --结义组成员名字长度
JIE_YI_ZU_TEXT_LENGTH = 128   --结义组宣言长度
JIE_YI_ZU_XUAN_YAN_TEXT_LENGTH = 300 --结义组纳新和自荐宣言长度(100字)
SWORN_PREFIX_ROLE_MAX_NUM = 4    --结义组成员最大数量

ROLE_INFO_BICYCLE_MAX_NUM = 10 -- 人物接收灵骑最大数量
PET_SOUL_EQUIP_NUM = 2 -- 炼妖后魂器变成2个
PET_LIAN_YAO_SKILL_MAX = 8 -- 炼妖后可能新增技能

MAX_PET_INBORN_GROUP_NUM = 20 -- 宠物天赋组最大个数

MAX_LOVERS_MARKET_STORE_COUNT = 20 -- 情缘小铺最大数量

MAX_RA_SANBAI_CHOU_TYPE_NUM = 10;			-- 抽奖等级区间不能超过10个
MAX_RA_SANBAI_CHOU_DRAW_NUM = 10;			-- 十连抽
MAX_RESONANCE_LEVEL = 9     -- 最大的强化共鸣等级

YXDM_MAX_ANSWER_LENGTH = 16 -- 月夕灯谜答案最长长度

PET_GAI_MING_ATTR_MAX_NUM = 20--改命属性个数
EQUIP_DIAN_HUA_SLOT_NUM = 4 --新点化方案个数
MAX_NETHER_WORLD_BAG_NUM = 100--// 幽冥背包格子数量
MAX_NETHER_WORLD_EQUIP_BAG_NUM = 200--// 冥装背包格子数量
MAX_NETHER_WORLD_SYSTEM_BAG_NUM = 300 --//幽冥系统最大格子数量
-- 改了此结构体 protocol_015 的 PetParam 必须同步改下
-- ==============================PortocolCommon===============================

PortocolCommon = PortocolCommon or {}

function PortocolCommon.PetProParam()
    local t = {}
    t.pet_unique_id1 = MsgAdapter.ReadUInt()
    t.pet_unique_id2 = MsgAdapter.ReadUInt()
    t.index = MsgAdapter.ReadShort()
    t.pet_state = MsgAdapter.ReadChar()
    t.is_bind = MsgAdapter.ReadChar()
    t.capaility = MsgAdapter.ReadInt()
    t.pet_id = MsgAdapter.ReadInt()
    t.name = MsgAdapter.ReadStrN(PROTC_ROLE_NAME_LEN)
    t.str_level = MsgAdapter.ReadUShort()
    t.level = MsgAdapter.ReadUShort()
    t.exp = MsgAdapter.ReadLL()
    t.add_exp = MsgAdapter.ReadLL()
    t.hp = MsgAdapter.ReadInt()
    t.mp = MsgAdapter.ReadInt()

    MsgAdapter.ReadInt()
    MsgAdapter.ReadChar()
    t.auto_add_points_flag = bit:SAnd({MsgAdapter.ReadUChar()}, true)
    MsgAdapter.ReadShort()

    -- 旧字段废弃后空读
    --[[    for i = 1, 8 do
        MsgAdapter.ReadInt()
    end
    for i = 1, 8 do
        MsgAdapter.ReadInt()
    end--]]

    MsgAdapter.ReadInt()
    t.use_attr_pellet_list = {}
    for i = 1, MAX_ATTR_PELLET_TYPE_NUM do
        t.use_attr_pellet_list[i] = MsgAdapter.ReadShort()
    end

    -- 资质
    t.con_growth = MsgAdapter.ReadUShort()
    t.str_growth = MsgAdapter.ReadUShort()
    t.def_growth = MsgAdapter.ReadUShort()
    t.agi_growth = MsgAdapter.ReadUShort()
    t.magic_growth = MsgAdapter.ReadUShort()
    -- 洗炼出来的资质
    t.new_con_growth = MsgAdapter.ReadUShort()
    t.new_str_growth = MsgAdapter.ReadUShort()
    t.new_def_growth = MsgAdapter.ReadUShort()
    t.new_agi_growth = MsgAdapter.ReadUShort()
    t.new_magic_growth = MsgAdapter.ReadUShort()
    -- 领悟技能的数量
    t.comprehead_gift_value = MsgAdapter.ReadInt()
    -- 领悟技能失败后累加的值（当前领悟成功率100%，不晓得以后会不会改，反正现在表里是有概率字段的）
    t.comprehead_passive_value = MsgAdapter.ReadInt()
    t.lock = MsgAdapter.ReadUChar()
    t.refined_flag = MsgAdapter.ReadUChar()
    -- 已分配属性点
    t.con = MsgAdapter.ReadUShort()
    t.str = MsgAdapter.ReadUShort()
    t.def = MsgAdapter.ReadUShort()
    t.agi = MsgAdapter.ReadUShort()
    t.magic = MsgAdapter.ReadUShort()

    t.max_hp = MsgAdapter.ReadInt()
    t.max_mp = MsgAdapter.ReadInt()
    t.pet_auto_move_type = MsgAdapter.ReadShort()
    t.pet_auto_skill_id = MsgAdapter.ReadShort()
    t.pet_auto_skill_level = MsgAdapter.ReadShort()
    t.guide_pet_flag = MsgAdapter.ReadChar()
    t.reserve_sh = MsgAdapter.ReadChar()

    t.item_unique_id_1 = MsgAdapter.ReadInt()
    t.item_unique_id_2 = MsgAdapter.ReadInt()

    t.pet_equipment_id = MsgAdapter.ReadUShort()
    t.equipment_skill_num = MsgAdapter.ReadUShort()
    t.equipment_skill_list = {}
    for i = 1, MAX_PET_EQUIPMENT_SKILL_NUM do
        t.equipment_skill_list[i] = MsgAdapter.ReadShort()
    end
    t.equipment_skill_refresh_list = {}
    for i = 1, MAX_PET_EQUIPMENT_SKILL_NUM do
        t.equipment_skill_refresh_list[i] = MsgAdapter.ReadShort()
    end
    t.skin_id = MsgAdapter.ReadInt()

    t.is_move_data = MsgAdapter.ReadChar()
    -- 突破标记
    t.is_up_level_breach = MsgAdapter.ReadChar()
    -- MsgAdapter.ReadShort()
    t.source = MsgAdapter.ReadUChar()
    t.has_refresh_points = MsgAdapter.ReadUChar()
    -- 当前宠物的天赋技能列表
    t.gift_list = {}
    for i = 1, PET_GIFT_MAX_COUNT do
        t.gift_list[i] = t.gift_list[i] or {}
        -- 天赋技能id
        t.gift_list[i].gift_id = MsgAdapter.ReadUShort()
        -- 天赋来源（0：洗炼出来的自带的，1：开领悟格子送的）
        t.gift_list[i].gift_source = MsgAdapter.ReadUChar()
        -- 保留字段，空读
        t.gift_list[i].skill_level = MsgAdapter.ReadUChar() + 1
    end

    -- 未保存的洗炼的结果,只洗资质的话这里的gift_id都是0
    t.new_gift_list = {}
    for i = 1, PET_GIFT_MAX_COUNT do
        t.new_gift_list[i] = MsgAdapter.ReadUShort()
        -- 洗炼结果的giftlist不需要考虑来源问题，除gift_id之外的直接空读掉
        MsgAdapter.ReadShort()
    end
    -- 打书替换
    t.replace_skill_id = MsgAdapter.ReadInt()
    t.replace_index = MsgAdapter.ReadUChar() + 1
    t.replace_type = MsgAdapter.ReadUChar() -- 0普通 1炼妖

    t.fei_sheng_times = MsgAdapter.ReadUChar() -- 飞升次数
    -- LogError("fei_sheng_times",t.fei_sheng_times)
    t.feisheng_jie_duan = MsgAdapter.ReadUChar() -- 当前飞升任务的进度

    -- 魂器1
    t.weapon_info = PetWeapon.DecodeInfo()
    t.weapon_info.param.pet_index = t.index
    t.weapon_info.param.use_pet_id = t.pet_id
    t.weapon_info.weapon_idx = 0
    -- LogError("宠物身上的魂器信息：", t.weapon_info)

    -- 神印方案
    t.stamp_blueprint_info = PetStampBlueprint.DecodeInfo(true)
    t.fei_sheng_select_skill_id = MsgAdapter.ReadInt()
    t.fei_sheng_select_skill_level = MsgAdapter.ReadInt() + 1
    -- LogError("宠物神印信息",t.stamp_blueprint_info)

    -- 宠物徽章
    t.bagde_item_param = PetBagde.DecodeItemParam()
    if not TableIsEmpty(t.bagde_item_param) then
        t.bagde_item_param.pet_index = t.index
    end
    -- LogError("宠物徽章：",t.bagde_item_param)

    -- 魂器2
    t.weapon_info2 = PetWeapon.DecodeInfo()
    t.weapon_info2.param.pet_index = t.index
    t.weapon_info2.param.use_pet_id = t.pet_id
    t.weapon_info2.weapon_idx = 1
    -- LogError("宠物身上的魂器2信息：", t.weapon_info2)

    -- 炼妖信息
    t.lian_yao_pet_id = MsgAdapter.ReadInt()
    t.lian_yao_pet_str_lv = MsgAdapter.ReadUShort()
    t.lian_yao_reserved_sh = MsgAdapter.ReadUShort()
    t.lian_yao_passive_list = {}
    for i = 1, PET_LIAN_YAO_SKILL_MAX do
        t.lian_yao_passive_list[i] = PortocolCommon.PetPassiveItemInfo(i)
    end

    t.inborn_info_list = PortocolCommon.DecodeInborn()

    t.pet_gai_ming_info = PortocolCommon.GaiMingInfo()
    
    return t
end
function PortocolCommon.PetPassiveItemInfo(i)
    local t = {}
    t.skill_id = MsgAdapter.ReadUShort()
    t.source = MsgAdapter.ReadUChar()
    t.skill_level = MsgAdapter.ReadUChar()
    t.index = i
    return t
end

-- 结义组名字和成员名字
function PortocolCommon.SwornName()
    local t = {}
    t.str1 = MsgAdapter.ReadStrN(SWORN_PREFIX_NAME_LEN)
    t.str1 = SwornData.NameFilter(t.str1)
    t.str2 = MsgAdapter.ReadStrN(SWORN_SUFFIX_NAME_LEN)
    t.str2 = SwornData.NameFilter(t.str2)
    t.member_num = MsgAdapter.ReadInt()
    t.sworn_name = t.str1 .. DataHelper.GetDaXie(t.member_num) .. t.str2 -- 前缀-人数-后缀
    return t
end
function PortocolCommon.SwornMemberName()
    local name_str = MsgAdapter.ReadStrN(SWORN_ROLE_NAME_LEN)
    name_str = SwornData.NameFilter(name_str)
    return name_str
end

function PortocolCommon.MsgRoleBaseInfo(t_table)
    local t = t_table or {}
    t.uid = MsgAdapter.ReadInt()
    t.name = MsgAdapter.ReadStrN(PROTC_ROLE_NAME_LEN)
    t.level = MsgAdapter.ReadInt()
    t.prof = MsgAdapter.ReadInt()
    t.avatar_type = MsgAdapter.ReadShort()
    t.avatar_id = MsgAdapter.ReadShort()
    return t
end

-- 宠物天赋信息
function PortocolCommon.DecodeInborn()
    local t = {}
    for i = 1, MAX_PET_INBORN_GROUP_NUM do
        local info = {}
        info.index = i -- 天赋下标
        info.inborn_grid = MsgAdapter.ReadUChar() -- 天赋位置
        info.inborn_level = MsgAdapter.ReadUChar() -- 天赋等级
        MsgAdapter.ReadShort()
        table.insert(t, info)
    end
    return t
end

function PortocolCommon.GaiMingInfo()
    local t = {}
	t.level = MsgAdapter.ReadUShort()--改命等级
	t.exp = MsgAdapter.ReadUShort()--改命当前经验
	t.attr_level = {}
	for i = 1, PET_GAI_MING_ATTR_MAX_NUM do
		t.attr_level[i] = MsgAdapter.ReadUChar()--改命属性等级
	end
    return t
end

-- 神域殿堂排行
function PortocolCommon.PalaceRankParam()
    local t = {}
    t.role_uuid = MsgAdapter.ReadLL()
	t.role_name = MsgAdapter.ReadStrN(PROTC_ROLE_NAME_LEN)
    t.name = t.role_name
	t.space_id = MsgAdapter.ReadInt()               --			//!< 神域id
	t.server_id = MsgAdapter.ReadInt()              --			//!< 服务器id
	t.season_id = MsgAdapter.ReadInt()              --			//!< 赛季id
    t.title_id = string.format(Language.GodAreasActs.PalaceTitle, DataHelper.GetDaXie(t.season_id))

	t.level = MsgAdapter.ReadInt()                  --			//!< 等级
	t.top_level = MsgAdapter.ReadInt()              --			//!< 巅峰等级
	t.prof_base = MsgAdapter.ReadChar()             --			//!< 职业[0,9)
	t.advance_time = MsgAdapter.ReadChar()         --		    //!< 进阶次数[0,6]
	t.avatar_type  = MsgAdapter.ReadChar()          --		    //!< 角色模型[1,6]
	t.color = MsgAdapter.ReadChar()                 --  		//!< 颜色[0,4)
	t.weapon_id = MsgAdapter.ReadUShort()           --		    //!< 武器ID
	t.sub_weapon_id =MsgAdapter.ReadUShort()        --	        //!< 副武器ID
	t.headshot_id = MsgAdapter.ReadShort()          --		    //!< 头像ID 
    t.avatar_id = t.headshot_id
	t.fly_flag= MsgAdapter.ReadShort()              --		    //!< 飞升阶段
	t.fashion_body_id = IllusionData.Instance:FashionIdToResId(MsgAdapter.ReadShort()) or 0-- //!< 幻化时装
	t.fashion_weapon_id = IllusionData.Instance:FashionIdToResId(MsgAdapter.ReadShort()) or 0--	//!< 幻化武器

	t.season_contribute_value = MsgAdapter.ReadLL()	-- 战功
    return t
end